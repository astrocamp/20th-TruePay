{% extends 'merchant_layout/dashboard_base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "å ±è¡¨åˆ†æ" %} - {{ merchant.ShopName }} - TruePay{% endblock %}


{% block content %}
<!-- é é¢æ¨™é¡Œ -->
<div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">{% trans "å ±è¡¨åˆ†æ" %}</h1>
    <p class="text-gray-600">{% trans "æŸ¥çœ‹å•†åº—ç‡Ÿé‹æ•¸æ“šèˆ‡è¶¨å‹¢åˆ†æ" %}</p>
</div>

<!-- æ™‚é–“ç¯„åœé¸æ“‡å™¨ -->
<div class="mb-6 bg-white rounded-lg shadow-md p-4">
    <div class="flex items-center justify-between">
        <h2 class="text-lg font-medium text-gray-900">{% trans "çµ±è¨ˆæœŸé–“" %}</h2>
        <div class="flex space-x-2">
            <a href="?days=7"
                class="px-4 py-2 text-sm rounded-md transition-colors duration-200 {% if days == 7 %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "æœ€è¿‘ 7 å¤©" %}
            </a>
            <a href="?days=30"
                class="px-4 py-2 text-sm rounded-md transition-colors duration-200 {% if days == 30 %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "æœ€è¿‘ 30 å¤©" %}
            </a>
            <a href="?days=90"
                class="px-4 py-2 text-sm rounded-md transition-colors duration-200 {% if days == 90 %}bg-blue-500 text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "æœ€è¿‘ 90 å¤©" %}
            </a>
        </div>
    </div>
</div>

<!-- çµ±è¨ˆå¡ç‰‡ -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- ç¸½ç‡Ÿæ”¶ -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm font-medium">{% trans "ç¸½ç‡Ÿæ”¶" %}</p>
                <p class="text-3xl font-bold text-green-600 mt-2">NT$ {{ total_revenue|floatformat:0 }}</p>
                <p class="text-gray-500 text-sm mt-1">{% trans "ç´¯è¨ˆé‡‘é¡" %}</p>
            </div>
            <div class="p-3 bg-green-50 rounded-full">
                <span class="text-2xl">ğŸ’°</span>
            </div>
        </div>
    </div>

    <!-- ç¸½è¨‚å–®æ•¸ -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm font-medium">{% trans "ç¸½è¨‚å–®æ•¸" %}</p>
                <p class="text-3xl font-bold text-[#0056B3] mt-2">{{ total_orders }}</p>
                <p class="text-gray-500 text-sm mt-1">{% trans "äº¤æ˜“è¨‚å–®" %}</p>
            </div>
            <div class="p-3 bg-blue-50 rounded-full">
                <span class="text-2xl">ğŸ“‹</span>
            </div>
        </div>
    </div>

    <!-- ç¥¨åˆ¸æ•¸é‡ -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm font-medium">{% trans "ç™¼è¡Œç¥¨åˆ¸" %}</p>
                <p class="text-3xl font-bold text-yellow-600 mt-2">{{ total_tickets }}</p>
                <p class="text-gray-500 text-sm mt-1">{% trans "ä½¿ç”¨ç‡" %} {{ ticket_usage_rate }}%</p>
            </div>
            <div class="p-3 bg-yellow-50 rounded-full">
                <span class="text-2xl">ğŸ«</span>
            </div>
        </div>
    </div>

    <!-- å•†å“æ•¸é‡ -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm font-medium">{% trans "å•†å“ç¸½æ•¸" %}</p>
                <p class="text-3xl font-bold text-purple-600 mt-2">{{ total_products }}</p>
                <p class="text-gray-500 text-sm mt-1">{% trans "æ´»èºå•†å“" %}</p>
            </div>
            <div class="p-3 bg-purple-50 rounded-full">
                <span class="text-2xl">ğŸ“¦</span>
            </div>
        </div>
    </div>
</div>

<!-- å ±è¡¨åŠŸèƒ½å€åŸŸ -->
<div x-data="reportPreview('{{ merchant.subdomain }}', {{ days }})">
    <!-- å ±è¡¨ä¸‹è¼‰å€åŸŸ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- éŠ·å”®åˆ†æå ±è¡¨ -->
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-200">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900">{% trans "éŠ·å”®åˆ†æå ±è¡¨" %}</h3>
                        <p class="text-sm text-gray-600">{% trans "ç‡Ÿæ”¶è¶¨å‹¢ã€è¨‚å–®ç‹€æ…‹ã€é‡‘æµåˆ†æ" %}</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                    <li>â€¢ {% trans "ç‡Ÿæ”¶ç¸½è¦½èˆ‡è¶¨å‹¢åˆ†æ" %}</li>
                    <li>â€¢ {% trans "è¨‚å–®æˆåŠŸç‡çµ±è¨ˆ" %}</li>
                    <li>â€¢ {% trans "é‡‘æµæ–¹å¼ä½¿ç”¨æ¯”ä¾‹" %}</li>
                    <li>â€¢ {% trans "å¹³å‡è¨‚å–®é‡‘é¡åˆ†æ" %}</li>
                </ul>
                <div class="flex space-x-2">
                    <button @click="openModal('sales')"
                        class="flex-1 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition duration-200 text-center cursor-pointer">
                        <i class="fas fa-chart-pie mr-2"></i> {% trans "é è¦½" %}
                    </button>
                    <a href="{% url 'merchant_account:export_sales' subdomain=merchant.subdomain %}?days={{ days }}"
                        class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200 inline-block text-center">
                        <i class="fas fa-download mr-2"></i>{% trans "ä¸‹è¼‰ Excel" %}
                    </a>
                </div>
            </div>
        </div>

        <!-- ç¥¨åˆ¸ç‡Ÿé‹å ±è¡¨ -->
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-200">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900">{% trans "ç¥¨åˆ¸ç‡Ÿé‹å ±è¡¨" %}</h3>
                        <p class="text-sm text-gray-600">{% trans "ä½¿ç”¨ç‡ã€é©—è­‰è¨˜éŒ„ã€éæœŸåˆ†æ" %}</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                    <li>â€¢ {% trans "ç¥¨åˆ¸ä½¿ç”¨ç‡çµ±è¨ˆ" %}</li>
                    <li>â€¢ {% trans "é©—è­‰æˆåŠŸç‡åˆ†æ" %}</li>
                    <li>â€¢ {% trans "éæœŸç¥¨åˆ¸æå¤±çµ±è¨ˆ" %}</li>
                    <li>â€¢ {% trans "ä½¿ç”¨æ™‚é–“åˆ†ä½ˆåˆ†æ" %}</li>
                </ul>
                <div class="flex space-x-2">
                    <button @click="openModal('tickets')"
                        class="flex-1 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition duration-200 text-center cursor-pointer">
                        <i class="fas fa-chart-pie mr-2"></i> {% trans "é è¦½" %}
                    </button>
                    <a href="{% url 'merchant_account:export_tickets' subdomain=merchant.subdomain %}?days={{ days }}"
                        class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200 inline-block text-center">
                        <i class="fas fa-download mr-2"></i>{% trans "ä¸‹è¼‰ Excel" %}
                    </a>
                </div>
            </div>
        </div>

        <!-- å•†å“è¡¨ç¾å ±è¡¨ -->
        <div class="bg-white rounded-lg shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-200">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900">{% trans "å•†å“è¡¨ç¾å ±è¡¨" %}</h3>
                        <p class="text-sm text-gray-600">{% trans "éŠ·é‡æ’è¡Œã€æ”¶å…¥è²¢ç»ã€åº«å­˜åˆ†æ" %}</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <ul class="text-sm text-gray-600 space-y-2 mb-4">
                    <li>â€¢ {% trans "å•†å“éŠ·å”®æ’è¡Œæ¦œ" %}</li>
                    <li>â€¢ {% trans "ç‡Ÿæ”¶è²¢ç»åº¦åˆ†æ" %}</li>
                    <li>â€¢ {% trans "åº«å­˜ç‹€æ³çµ±è¨ˆ" %}</li>
                    <li>â€¢ {% trans "å•†å“å®šåƒ¹æ•ˆç‡åˆ†æ" %}</li>
                </ul>
                <div class="flex space-x-2">
                    <button @click="openModal('products')"
                        class="flex-1 bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition duration-200 text-center cursor-pointer">
                        <i class="fas fa-chart-pie mr-2"></i> {% trans "é è¦½" %}
                    </button>
                    <a href="{% url 'merchant_account:export_products' subdomain=merchant.subdomain %}?days={{ days }}"
                        class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200 inline-block text-center">
                        <i class="fas fa-download mr-2"></i>{% trans "ä¸‹è¼‰ Excel" %}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ–è¡¨é è¦½æ¨¡æ…‹è¦–çª— -->
    <div x-show="showModal" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50" @click="closeModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" @click.stop>
                <div class="p-6">
                    <!-- æ¨¡æ…‹è¦–çª—æ¨™é¡Œ -->
                    <div class="flex justify-between items-center mb-6">
                        <h3 x-text="modalTitle" class="text-xl font-bold text-gray-900"></h3>
                        <button @click="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <!-- è¼‰å…¥å‹•ç•« -->
                    <div x-show="loading" class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                        <span class="ml-3 text-gray-600">{% trans "è¼‰å…¥åœ–è¡¨ä¸­..." %}</span>
                    </div>

                    <!-- åœ–è¡¨åˆ†é  -->
                    <div x-show="!loading && !error">
                        <div class="flex border-b border-gray-200 mb-6">
                            <button @click="switchTab(1)"
                                :class="activeTab === 1
                                    ? 'py-2 px-4 text-sm font-medium text-center text-blue-600 bg-gray-50 border-b-2 border-blue-600 rounded-t-lg'
                                    : 'py-2 px-4 ml-1 text-sm font-medium text-center text-gray-500 rounded-t-lg hover:text-gray-600 hover:bg-gray-50'">
                                {% trans "ä¸»è¦åˆ†æ" %}
                            </button>
                            <button @click="switchTab(2)"
                                :class="activeTab === 2
                                    ? 'py-2 px-4 ml-1 text-sm font-medium text-center text-blue-600 bg-gray-50 border-b-2 border-blue-600 rounded-t-lg'
                                    : 'py-2 px-4 ml-1 text-sm font-medium text-center text-gray-500 rounded-t-lg hover:text-gray-600 hover:bg-gray-50'">
                                {% trans "è©³ç´°åˆ†ä½ˆ" %}
                            </button>
                        </div>

                        <!-- ä¸»è¦åœ–è¡¨ -->
                        <div x-show="activeTab === 1" class="chart-tab">
                            <canvas id="mainChart" width="800" height="400"></canvas>
                        </div>

                        <!-- è¼”åŠ©åœ–è¡¨ -->
                        <div x-show="activeTab === 2" class="chart-tab">
                            <canvas id="subChart" width="800" height="400"></canvas>
                        </div>
                    </div>

                    <!-- éŒ¯èª¤è¨Šæ¯ -->
                    <div x-show="error" class="text-center py-12">
                        <div class="text-red-500 text-lg mb-2">
                            <i class="fas fa-exclamation-triangle"></i> {% trans "è¼‰å…¥å¤±æ•—" %}
                        </div>
                        <p class="text-gray-600">{% trans "ç„¡æ³•è¼‰å…¥åœ–è¡¨æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨èªªæ˜ -->
    <div class="mt-8 bg-blue-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-blue-900 mb-6">ğŸ“‹ {% trans "å ±è¡¨ä½¿ç”¨èªªæ˜" %}</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 text-sm text-blue-800">
            <div>
                <h4 class="font-medium mb-3 text-base">{% trans "å ±è¡¨åŠŸèƒ½" %}</h4>
                <ul class="space-y-2">
                    <li>â€¢ {% trans "æ”¯æ´å¤šç¨®æ™‚é–“ç¯„åœé¸æ“‡ï¼ˆ7å¤©ã€30å¤©ã€90å¤©ï¼‰" %}</li>
                    <li>â€¢ {% trans "è‡ªå‹•ç”Ÿæˆè©³ç´°çµ±è¨ˆåœ–è¡¨èˆ‡è¦–è¦ºåŒ–åˆ†æ" %}</li>
                    <li>â€¢ {% trans "Excel æ ¼å¼åŒ¯å‡ºï¼Œæ–¹ä¾¿å¾ŒçºŒæ•¸æ“šåˆ†æ" %}</li>
                    <li>â€¢ {% trans "å³æ™‚é è¦½åŠŸèƒ½ï¼Œå¿«é€Ÿæª¢è¦–å ±è¡¨å…§å®¹" %}</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium mb-3 text-base">{% trans "æ›´æ–°èˆ‡å»ºè­°" %}</h4>
                <ul class="space-y-2">
                    <li>â€¢ {% trans "æ•¸æ“šå³æ™‚æ›´æ–°ï¼Œç¢ºä¿è³‡è¨Šæº–ç¢ºæ€§" %}</li>
                    <li>â€¢ {% trans "å»ºè­°å®šæœŸä¸‹è¼‰åˆ†æï¼Œè¿½è¹¤ç‡Ÿé‹è¶¨å‹¢" %}</li>
                    <li>â€¢ {% trans "å¯ç”¨æ–¼åˆ¶å®šç‡Ÿé‹æ±ºç­–èˆ‡ç­–ç•¥è¦åŠƒ" %}</li>
                    <li>â€¢ {% trans "æ”¯æ´å¤šç¨®åœ–è¡¨æ ¼å¼ï¼Œæ»¿è¶³ä¸åŒéœ€æ±‚" %}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}