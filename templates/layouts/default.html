{% load static %} {% load merchant_tags %}
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      href="{% static 'styles/app.css' %}"
      rel="stylesheet"
      type="text/css"
    />
    <script src="{% static 'scripts/app.js' %}" defer></script> 


    <title>{% block title %}TruePay 首頁{% endblock %}</title>
  </head>
   <body class="bg-brand-background text-brand-text font-sans">
    <!-- 導覽列 -->

    <nav class="bg-brand-white border-b border-brand-grayBorder px-4 py-3" 
         x-data="{ ...NavigationManager.createAlpineData(), ...createMobileMenu() }">
      <div class="max-w-screen-xl mx-auto flex items-center justify-between">
        <!-- 左側：手機時顯示漢堡 + 品牌 -->
        <div class="flex items-center gap-3">
         <!-- 漢堡按鈕 (手機版) -->
          <button @click="toggle()" 
                  :aria-expanded="isOpen"
                  x-show="!isOpen"
                  class="md:hidden p-2 text-brand-black focus:outline-none">
            ☰
          </button>
          <!-- 品牌名稱 (桌機版才顯示 / 手機展開時隱藏) -->
          <a href="{% url 'pages:home' %}" 
             :class="isOpen ? 'hidden' : 'flex'"
             class="items-center gap-2">
              <img src="{% static 'images/truepay-logo.png' %}" alt="TruePay Logo" class="h-8 w-auto">
              <span class="text-lg font-bold text-brand-text md:text-xl">TruePay</span>
          </a>
      </div>
        <!-- 桌機版選單 -->
        <ul class= "hidden md:flex items-center gap-6 text-sm font-medium">
          <li>
            <a
              href="{% url 'pages:home' %}"
              x-bind="navLinkBinding($el)"
              >首頁</a
            >
          </li>
          <li>
            <a
              href="{% url 'pages:marketplace' %}"
              x-bind="navLinkBinding($el)"
              >商品總覽</a
            >
          {% if user.is_authenticated %}
            {% if user.member_type == "merchant" %}
              <li>
                <a href="{% get_current_merchant %}" x-bind="navLinkBinding($el)">商家後台</a>
              </li>
            {% else %}
              <li>
                <a href="{% url 'customers_account:dashboard' %}" x-bind="navLinkBinding($el)">我的帳戶</a>
              </li>
            {% endif %}
            <li>
              <a href="{% if user.member_type == 'merchant' %}{% url 'merchant_account:logout' %}{% else %}{% url 'customers_account:logout' %}{% endif %}"
                 x-bind="logoutLinkBinding()">登出</a>
            </li>
          {% else %}
            <li>
              <a
                href="{% url 'pages:selectrole' %}"
                x-bind="navLinkBinding($el)"
                >登入/註冊</a
              >
            </li>
          {% endif %}
        </ul>
      </div>
      
      <!-- 手機版選單 (預設隱藏) -->
      <div x-show="isOpen" 
           x-transition
           @click="handleLinkClick($event)"
           class="md:hidden max-w-screen-xl mx-auto border-brand-grayBorder bg-brand-white relative"
      >
        <!-- 關閉按鈕 -->
        <button @click="toggle()" class="absolute top-4 right-4 text-2xl text-brand-black focus:outline-none">✕</button>
        
        <!-- 展開後的品牌名稱 -->
        <div class="px-6 py-4 font-bold text-brand-black text-lg border-b border-brand-grayBorder text-center">
          <span>TruePay</span>
        </div>
        <ul class="flex flex-col text-base font-medium">
          <li>
            <a
              href="{% url 'pages:home' %}"
              x-bind="navLinkBinding($el)"
              class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
              >首頁</a
            >
          </li>
          <li>
            <a
              href="{% url 'pages:marketplace' %}"
              x-bind="navLinkBinding($el)"
              class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
              >商品總覽</a
            >
          </li>
          {% if user.is_authenticated %}
            {% if user.member_type == "merchant" %}
              <li>
                <a
                  href="{% get_current_merchant %}"
                  x-bind="navLinkBinding($el)"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >商家後台</a
                >
              </li>
              <li>
                <a
                  href="{% url 'merchant_account:logout' %}"
                  x-bind="logoutLinkBinding()"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >登出</a
                >
              </li>
            {% elif user.member_type == "customer" %}
              <li>
                <a
                  href="{% url 'customers_account:dashboard' %}"
                  x-bind="navLinkBinding($el)"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >我的帳戶</a
                >
              </li>
              <li>
                <a
                  href="{% url 'customers_account:logout' %}"
                  x-bind="logoutLinkBinding()"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >登出</a
                >
              </li>
            {% else %}
              <li>
                <a
                  href="{% url 'customers_account:dashboard' %}"
                  x-bind="navLinkBinding($el)"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >我的帳戶</a
                >
              </li>
              <li>
                <a
                  href="{% url 'customers_account:logout' %}"
                  x-bind="logoutLinkBinding()"
                  class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                  >登出</a
                >
              </li>
            {% endif %}
          {% else %}
            <li>
              <a
                href="{% url 'pages:selectrole' %}"
                x-bind="navLinkBinding($el)"
                class="block px-6 py-4 text-brand-black hover:bg-gray-50 transition-colors text-center"
                >登入/註冊</a
              >
            </li>
          {% endif %}
        </ul>
      </div>
    </nav>

    <!-- 主內容區塊 -->
    <main class="max-w-screen-xl mx-auto px-6 py-12">
      {% block content %} {% endblock %}
    </main>

    <!-- 頁尾（可加上 components/footer.html） -->
    <footer class="bg-brand-grayLight text-center text-sm text-gray-500 py-6">
      &copy; {{ now|date:"Y" }} TruePay. All rights reserved.
    </footer>
  </body>
</html>
